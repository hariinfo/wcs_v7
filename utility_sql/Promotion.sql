-- Get product level, order level and shipping promotion for a store.
SELECT T0.PX_PROMOTION_ID, T0.NAME,T2.CALCODE_ID FROM PX_PROMOTION T0, PX_GROUP T1, CLCDPROMO T2, CALCODE T3
WHERE T0.PX_GROUP_ID=T1.PX_GROUP_ID AND T0.PX_PROMOTION_ID=T2.PX_PROMOTION_ID AND T2.CALCODE_ID=T3.CALCODE_ID
AND T0.STOREENT_ID IN (10951) AND T0.STATUS =1 AND T0.CDREQUIRED=0 AND T0.TYPE=0
AND T0.STARTDATE <= current_timestamp AND T0.ENDDATE >= current_timestamp 
AND T1.GRPNAME IN ('ProductLevelPromotion','OrderLevelPromotion','ShippingPromotion')
AND T1.STOREENT_ID IN (10951) AND T3.DISPLAYLEVEL=1;

-- Get promotion that is not defined at ORDER level

SELECT T0.PX_PROMOTION_ID, T0.NAME FROM PX_PROMOTION T0, PX_GROUP T1
WHERE T0.PX_GROUP_ID=T1.PX_GROUP_ID AND T0.STOREENT_ID IN (10951)
AND T0.STATUS =1 AND T0.CDREQUIRED=0 AND T0.TYPE=0 AND
T0.STARTDATE <= current_timestamp AND T0.ENDDATE >= current_timestamp
AND T1.GRPNAME IN ('ProductLevelPromotion','OrderLevelPromotion','ShippingPromotion')
AND T1.STOREENT_ID IN (10951) AND NOT EXISTS(SELECT 1 FROM CLCDPROMO T2, CATENCALCD T3 
WHERE T2.CALCODE_ID=T3.CALCODE_ID AND T0.PX_PROMOTION_ID=T2.PX_PROMOTION_ID
UNION ALL SELECT 1 FROM CLCDPROMO T4, CATGPCALCD T5 
WHERE T4.CALCODE_ID=T5.CALCODE_ID AND T0.PX_PROMOTION_ID=T4.PX_PROMOTION_ID);

-- Get promotions applied to an Order

SELECT T1.CALUSAGE_ID, T1.CALCODE_ID, T1.ORDERS_ID, T1.ORDADJUST_ID, T1.AMOUNT, T1.DISPLAYLEVEL, T1.OPTCOUNTER
FROM ORDADJUST  T1 WHERE T1.ORDERS_ID =21004 and T1.CALUSAGE_ID =-1;

-- Get order line item level adjustment for an order line item
SELECT T1.ORDIADJUST_ID, T1.AMOUNT, T1.ORDADJUST_ID, T1.ORDERITEMS_ID, T1.OPTCOUNTER FROM ORDIADJUST T1 WHERE (T1.ORDADJUST_ID =21504)

-- Get promotions applicable for a catentry id where
-- 11657,11658 are product and item beans
SELECT T0.PX_PROMOTION_ID, T0.name FROM PX_PROMOTION T0, PX_GROUP T1, CLCDPROMO T2, CATENCALCD T3 WHERE T0.PX_GROUP_ID=T1.PX_GROUP_ID AND T0.PX_PROMOTION_ID=T2.PX_PROMOTION_ID AND T2.CALCODE_ID=T3.CALCODE_ID AND T0.STOREENT_ID IN (10951) AND T0.STATUS =1 AND T0.CDREQUIRED=0 AND T0.TYPE=0 AND T0.STARTDATE <= current_timestamp AND T0.ENDDATE >= current_timestamp AND T1.GRPNAME IN ('ProductLevelPromotion','OrderLevelPromotion','ShippingPromotion') AND T1.STOREENT_ID IN (10951) AND (T3.CATENTRY_ID IS NULL OR T3.CATENTRY_ID IN (11657,11658)) AND T3.STORE_ID IN (10951);

--Get promo codes which are not applied to the Order
SELECT CDP.CODE FROM PX_CDPOOL CDP, PX_CDUSAGE CDU WHERE ORDERS_ID = ? AND CDU.PX_CDPOOL_ID = CDP.PX_CDPOOL_ID AND CDP.CODE NOT IN (SELECT CDP.CODE FROM  ORDADJUST OA,PX_CDUSAGE CDU,PX_CDPOOL CDP,CLCDPROMO CLCD,PX_CDPROMO PXCDP WHERE OA.ORDERS_ID=? AND OA.ORDERS_ID = CDU.ORDERS_ID AND CDU.PX_CDPOOL_ID = CDP.PX_CDPOOL_ID AND OA.CALCODE_ID = CLCD.CALCODE_ID AND CLCD.PX_PROMOTION_ID = PXCDP.PX_PROMOTION_ID AND PXCDP.PX_CDPOOL_ID = CDP.PX_CDPOOL_ID) AND CDP.CODE NOT IN (SELECT CDP.CODE FROM PX_CDUSAGE CDU,PX_CDPOOL CDP,CLCDPROMO CLCD,PX_CDPROMO PXCDP,PX_RWDOPTION PXRWD WHERE CDU.ORDERS_ID=? AND CDU.ORDERS_ID=PXRWD.ORDERS_ID AND PXRWD.PX_PROMOTION_ID=PXCDP.PX_PROMOTION_ID AND CDU.PX_CDPOOL_ID = CDP.PX_CDPOOL_ID AND CLCD.PX_PROMOTION_ID = PXCDP.PX_PROMOTION_ID AND PXCDP.PX_CDPOOL_ID = CDP.PX_CDPOOL_ID AND PXCDP.PX_PROMOTION_ID IN (SELECT DISTINCT PX_PROMOTION_ID FROM PX_ELEMENT WHERE PX_ELEMENT_ID IN (SELECT PX_ELEMENT_ID FROM PX_ELEMENTNVP WHERE NAME = 'chooseBehavior' AND Value = 'pickFreeGift')))

-- Get promo codes applied for the Order
SELECT CDUSAGE.PX_CDUSAGE_ID FROM PX_CDPOOL PXCD,PX_CDUSAGE CDUSAGE WHERE
PXCD.CODE = ? AND  PXCD.PX_CDPOOL_ID = CDUSAGE.PX_CDPOOL_ID
AND CDUSAGE.ORDERS_ID = ? AND CDUSAGE.STATUS = 4


